apiVersion: skaffold/v2beta16
kind: Config
build:
  artifacts:
    - image: bm-licensing
      docker:
        dockerfile: k8s/Dockerfile.dev

profiles:
  - name: init
    deploy:
      kustomize:
        paths:
          - "k8s"
    portForward:
      - resourceType: Service
        resourceName: ingress-nginx-controller
        port: 443
        localPort: 8443
  - name: run-api
    deploy:
      kubectl:
        manifests:
          - k8s/dist/licensing.k8s.yaml
    portForward:
      - resourceType: Service
        resourceName: ingress-nginx-controller
        port: 443
        localPort: 8443
  - name: create-db
    deploy:
      kubectl:
        manifests:
          - k8s/dist/postgres.k8s.yaml
  - name: run-migration
    deploy:
      kubectl:
        manifests:
          - k8s/dist/migration.k8s.yaml
